<div class="container-fluid">

    <div class="row">
        <div class="col-md-12">

            <!-- Character Tabs -->

            <div class="row tab-header">
                <ul class="list-inline tab-list">
                    <li ng-repeat="(ind, character) in characters" ng-click="selectCharacter(ind)" class="tab bg-default text-center" ng-class="ind === selectedCharacterIndex ? 'selected' : 'unselected'">
                        <span>{{ character.name }}</span>
                        &nbsp;
                        <span class="close" ng-click="removeCharacter(ind)">&times;</span>
                    </li>
                    <li><button type="button" class="btn btn-success btn-xs glyphicon glyphicon-plus" ng-click="addCharacter()"></button></li>
                </ul>
            </div>

            <!-- Body Content -->
            <div class="row content bg-default">
                <div class="col-md-10">
                    <div ng-if="edit !== 'name'">
                        <h1 ng-click="setEdit('name', 'selectedCharacter.name')" class="inline-block clickable">[ {{ selectedCharacter.name }} ]</h1>
                    </div>
                    <div ng-if="edit === 'name'">
                        <input ng-model="selectedCharacter.name" class="h1" />
                        <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></button>
                        <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></button>
                    </div>
                </div>

                <div class="col-md-2 text-right" style="height: 100%">
                    <button type="button" class="btn btn-default">Import</button>
                    <button type="button" class="btn btn-default">Export</button>
                </div>

                <!-- Static information -->
                <div class="row col-md-4">
                    <div class="col-md-12">
                        <div ng-if="edit !== 'race'">
                            <p class="clickable" ng-click="setEdit('race', 'selectedCharacter.race')">
                                <strong>Race: </strong>
                                <span>[ {{ selectedCharacter.race }} ]</span>
                            </p>
                        </div>
                        <div ng-if="edit === 'race'">
                            <input ng-model="selectedCharacter.race" />
                            <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                            <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <div ng-if="edit !== 'class'">
                            <p class="clickable" ng-click="setEdit('class', 'selectedCharacter.class')">
                                <strong>Class: </strong>
                                <span>[ {{ selectedCharacter.class }} ]</span>
                            </p>
                        </div>
                        <div ng-if="edit === 'class'">
                            <input ng-model="selectedCharacter.class" />
                            <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                            <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <strong>Base Ability Scores</strong>
                    </div>

                    <div class="col-md-12" ng-repeat="score in abilityScores">
                        <div ng-click="setEdit('base-' + score, 'selectedCharacter.abilityScores.' + score)" ng-if="edit !== 'base-' + score" class="clickable">
                            <div class="row">
                                <div class="col-md-4 text-capitalize">{{ score }}: </div>
                                <div class="col-md-4">
                                    [ {{ selectedCharacter.abilityScores[score] }} ]
                                </div>
                                <div class="col-md-4">
                                    {{ getAbilityMod(selectedCharacter.abilityScores[score]) }}
                                </div>
                            </div>
                        </div>

                        <div ng-click="setEdit('base-' + score, 'selectedCharacter.abilityScores.' + score)" ng-if="edit === 'base-' + score" class="clickable">
                            <div class="row">
                                <div class="col-md-4 text-capitalize">{{ score }}: </div>
                                <div class="col-md-8">
                                    <input type="number" step="any" ng-model="selectedCharacter.abilityScores[score]" />
                                    <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                    <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12">
                        <strong>Point Buy: </strong>
                        {{ getPointBuy(selectedCharacter) }}
                    </div>

                </div>

                <!-- Level information -->
                <div class="row col-md-12">

                    <!-- Level tabs -->
                    <div class="row col-md-1">
                        <ul class="list-unstyled tab-list">
                            <li ng-click="selectLevel(selectedCharacter, ind)" ng-repeat="(ind, level) in selectedCharacter.levels" class="tab bg-default text-center" ng-class="ind === selectedCharacter.selectedLevelIndex ? 'unselected' : 'selected'">
                                <span>{{ level.level }}</span>
                                <span class="close" ng-click="removeLevel(selectedCharacter, ind)">&times;</span>
                            </li>
                            <li class="text-right">
                                <button type="button" class="btn btn-success btn-xs glyphicon glyphicon-sort-by-order" ng-click="sortLevel(selectedCharacter)"></button>
                                <button type="button" class="btn btn-success btn-xs glyphicon glyphicon-plus" ng-click="addLevel(selectedCharacter)"></button>
                            </li>
                        </ul>
                    </div>

                    <!-- Level information -->
                    <div class="col-md-11 bg-unstyle">

                        <div ng-if="selectedCharacter.levels.length > 0" class="row col-md-12">
                            <div class="col-md-12">
                                <div ng-click="setEdit('level', 'selectedCharacter.selectedLevel.level')" ng-if="edit !== 'level'" class="clickable">
                                    <h2>[ Level {{ selectedCharacter.selectedLevel.level }} ]</h2>
                                </div>

                                <div ng-if="edit === 'level'">
                                    <input ng-model="selectedCharacter.selectedLevel.level" class="h2" type="number" step="any" />
                                    <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></button>
                                    <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></button>
                                </div>
                            </div>

                            <!-- Standard Stats -->
                            <div class="col-md-12 row" ng-repeat="stat in standardStats">
                                <hr />
                                <div class="col-md-12 row" ng-if="stat.renderType === RENDER_TYPE.INLINE">
                                    <div class="col-md-1">
                                        <u>{{ stat.title }}</u>
                                        {{ getStat(selectedCharacter, selectedCharacter.selectedLevel, stat.name) }}
                                    </div>
                                    <div class="row col-md-2" ng-repeat="mod in selectedCharacter.selectedLevel[stat.name] | orderObjectBy:stat.order">
                                        <div class="col-md-4 text-capitalize">
                                            {{ mod.title || mod._objectKey }}:
                                        </div>
                                        <div class="col-md-8">
                                            <div ng-if="mod.type !== BONUS_TYPE.DYNAMIC">{{ getValue(selectedCharacter, selectedCharacter.selectedLevel, mod) }}</div>
                                            <div ng-if="mod.type === BONUS_TYPE.DYNAMIC" class="clickable">
                                                <div ng-if="edit !== stat.name + '-' + mod._objectKey" ng-click="setEdit(stat.name + '-' + mod._objectKey, 'selectedCharacter.selectedLevel.' + stat.name + '.' + mod._objectKey + '.' + 'value')">
                                                    <span ng-if="!mod.applyOnce">({{ getStatMod(selectedCharacter, selectedCharacter.selectedLevel, stat.name, mod._objectKey) }})</span>
                                                     [ {{ getValue(selectedCharacter, selectedCharacter.selectedLevel, mod) }} ]
                                                </div>
                                                <div ng-if="edit === stat.name + '-' + mod._objectKey">
                                                    <input type="number" step="any" ng-model="selectedCharacter.selectedLevel[stat.name][mod._objectKey].value" />
                                                    <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                                    <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12 row" ng-if="stat.renderType === RENDER_TYPE.HEADER">
                                    <div class="col-md-12 row">
                                        <div class="col-md-1">
                                            <u>{{ stat.title }}</u>
                                        </div>
                                        <div class="text-center text-capitalize col-md-1" ng-repeat="mod in selectedCharacter.selectedLevel[stat.name] | orderObjectBy:statOrder">
                                            <u>{{ mod.title || mod._objectKey }}</u>
                                        </div>
                                    </div>

                                    <div class="col-md-12 row">
                                        <div class="col-md-1">
                                            {{ getStat(selectedCharacter, selectedCharacter.selectedLevel, stat.name) }} 
                                        </div>
                                        <div class="text-center col-md-1" ng-repeat="mod in selectedCharacter.selectedLevel[stat.name] | orderObjectBy:statOrder">
                                            <div ng-if="mod.type !== BONUS_TYPE.DYNAMIC">{{ getValue(selectedCharacter, selectedCharacter.selectedLevel, mod) }}</div>
                                            <div ng-if="mod.type === BONUS_TYPE.DYNAMIC" class="clickable">
                                                <div ng-if="edit !== stat.name + '-' + mod._objectKey" ng-click="setEdit(stat.name + '-' + mod._objectKey, 'selectedCharacter.selectedLevel.' + stat.name + '.' + mod._objectKey + '.' + 'value')">
                                                    <span ng-if="!mod.applyOnce">({{ getStatMod(selectedCharacter, selectedCharacter.selectedLevel, stat.name, mod._objectKey) }})</span>
                                                     [ {{ getValue(selectedCharacter, selectedCharacter.selectedLevel, mod) }} ]
                                                </div>
                                                <div ng-if="edit === stat.name + '-' + mod._objectKey">
                                                    <input type="number" step="any" ng-model="selectedCharacter.selectedLevel[stat.name][mod._objectKey].value" />
                                                    <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                                    <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12 row" ng-if="stat.renderType === RENDER_TYPE.GROUP">
                                    <div class="col-md-12 row">
                                        <div class="col-md-1">
                                            <u>{{ stat.title }}</u>
                                        </div>
                                        <div class="text-center text-capitalize col-md-1" ng-repeat="col in stat.additionalColumns | orderBy:statOrder">
                                            <u>{{ col.title }}</u>
                                        </div>
                                        <div class="text-center text-capitalize col-md-1" ng-repeat="mod in selectedCharacter.selectedLevel[stat.items[0].name] | orderObjectBy:statOrder">
                                            <u>{{ mod.title || mod._objectKey }}</u>
                                        </div>
                                    </div>

                                    <div class="col-md-12 row" ng-repeat="item in stat.items">
                                        <div class="col-md-1">
                                            {{ item.title }} {{ getStat(selectedCharacter, selectedCharacter.selectedLevel, item.name) }}
                                        </div>
                                        <div class="text-center col-md-1" ng-repeat="col in stat.additionalColumns | orderBy:statOrder">
                                            {{ col.value(getStat(selectedCharacter, selectedCharacter.selectedLevel, item.name)) }}
                                        </div>
                                        <div class="text-center col-md-1" ng-repeat="mod in selectedCharacter.selectedLevel[item.name] | orderObjectBy:statOrder">
                                            <div ng-if="mod.type !== BONUS_TYPE.DYNAMIC">{{ getValue(selectedCharacter, selectedCharacter.selectedLevel, mod) }}</div>
                                            <div ng-if="mod.type === BONUS_TYPE.DYNAMIC" class="clickable">
                                                <div ng-if="edit !== item.name + '-' + mod._objectKey" ng-click="setEdit(item.name + '-' + mod._objectKey, 'selectedCharacter.selectedLevel.' + item.name + '.' + mod._objectKey + '.' + 'value')">
                                                    <span ng-if="!mod.applyOnce">({{ getStatMod(selectedCharacter, selectedCharacter.selectedLevel, item.name, mod._objectKey) }})</span>
                                                     [ {{ getValue(selectedCharacter, selectedCharacter.selectedLevel, mod) }} ]
                                                </div>
                                                <div ng-if="edit === item.name + '-' + mod._objectKey">
                                                    <input type="number" step="any" ng-model="selectedCharacter.selectedLevel[item.name][mod._objectKey].value" />
                                                    <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                                    <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /Standard Stat -->

                            <div class="col-md-12 row">
                                <div class="col-md-12">
                                    <u>Attack Groups</u>
                                    <button type="button" ng-click="addAttackGroup(selectedCharacter.selectedLevel)" class="btn btn-success btn-xs glyphicon glyphicon-plus"></button>
                                </div>
                                <div class="col-md-12" ng-repeat="(ind, atkGroup) in selectedCharacter.selectedLevel.attackGroups">
                                    <div class="col-md-1">
                                        <button type="button" ng-click="removeAttackGroup(selectedCharacter.selectedLevel, ind)" class="btn btn-danger btn-xs glyphicon glyphicon-trash"></button>
                                        <button type="button" ng-click="selectAttackGroup(selectedCharacter.selectedLevel, ind)" class="btn btn-primary btn-xs glyphicon glyphicon-pencil" ng-if="selectedCharacter.selectedLevel.selectedAttackGroupIndex !== ind"></button>
                                        <button type="button" ng-click="addAttack(selectedCharacter.selectedLevel.selectedAttackGroup)" class="btn btn-success btn-xs glyphicon glyphicon-plus" ng-if="selectedCharacter.selectedLevel.selectedAttackGroupIndex === ind"></button>
                                    </div>
                                    <div class="col-md-11" ng-if="selectedCharacter.selectedLevel.selectedAttackGroupIndex !== ind">
                                        {{ atkGroup.name }}
                                    </div>
                                    <div class="col-md-11 clickable" ng-click="setEdit('atkGroup-name', 'selectedCharacter.selectedLevel.selectedAttackGroup.name')" ng-if="edit !== 'atkGroup-name'">
                                        [ {{ atkGroup.name }} ]
                                    </div>
                                    <!-- TODO: DPR GOES HERE -->
                                    <div class="col-md-12 row bg-default rounded" ng-if="selectedCharacter.selectedLevel.selectedAttackGroupIndex === ind">
                                        <div class="col-md-11" ng-if="edit === 'atkGroup-name'">
                                            <input type="text" ng-model="selectedCharacter.selectedLevel.selectedAttackGroup.name" />
                                            <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                            <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                        </div>
                                        <div class="col-md-12">
                                            <u>Attacks</u>
                                        </div>
                                        <div class="col-md-12 row" ng-if="selectedCharacter.selectedLevel.selectedAttackGroupIndex === ind" ng-repeat="(atkInd, atk) in atkGroup.attacks">
                                            <div class="col-md-2 row">
                                                <div class="col-md-5 text-center">
                                                    <button type="button" ng-click="removeAttack(atkGroup, atkInd)" class="btn btn-danger btn-xs glyphicon glyphicon-trash"></button>
                                                    <button type="button" ng-click="selectAttack(atkGroup, atkInd)" class="btn btn-primary btn-xs glyphicon glyphicon-pencil" ng-if="atkGroup.selectedAttackIndex !== atkInd"></button>
                                                </div>
                                                <div class="col-md-7" ng-if="atkGroup.selectedAttackIndex !== atkInd">
                                                    {{ atk.weapon }}
                                                </div>
                                                <div class="col-md-7" ng-if="atkGroup.selectedAttackIndex === atkInd">
                                                    <div class="col-md-12 row" ng-click="setEdit('atk-weapon', 'selectedCharacter.selectedLevel.selectedAttackGroup.selectedAttack.weapon')" ng-if="edit !== 'atk-weapon'">
                                                        [&nbsp;{{ atk.weapon }}&nbsp;]
                                                    </div>
                                                    <div class="col-md-12 row" ng-if="edit === 'atk-weapon'">
                                                        <input type="text" ng-model="selectedCharacter.selectedLevel.selectedAttackGroup.selectedAttack.weapon" />
                                                        <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                                        <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3 row">
                                                <div class="col-md-6">
                                                    <u>Hit Bonus:</u>
                                                    <button type="button" ng-click="addHit(atk)" ng-if="atkGroup.selectedAttackIndex === atkInd" class="btn btn-success btn-xs glyphicon glyphicon-plus"></button>
                                                </div>
                                                <div class="col-md-6">
                                                    <!-- TODO: Calculate -->
                                                </div>
                                                <div ng-if="atkGroup.selectedAttackIndex === atkInd" class="col-md-12 row">
                                                    <div class="col-md-12 row">
                                                        <div class="col-md-6">
                                                            <u>Bonus Type</u>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <u>Value</u>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12 row" ng-repeat="(hitInd, hit) in atk.hitChance">

                                                        <div class="col-md-6" ng-click="setEdit('atkHit-' + atkInd + '-' + hitInd, 'selectedCharacter.selectedLevel.selectedAttackGroup.selectedAttack.hitChance.' + hitInd + '.type', hit, 'value')" ng-if="edit !== 'atkHit-' + atkInd + '-' + hitInd">
                                                            <button type="button" ng-click="removeHit(atk, hitInd)" class="btn btn-danger btn-xs glyphicon glyphicon-trash"></button>
                                                            [ {{ bonusTypeText(hit.type) }} ]
                                                        </div>
                                                        <div class="col-md-6" ng-if="edit === 'atkHit-' + atkInd + '-' + hitInd">
                                                            <select class="form-control input-sm" ng-model="hit.type">
                                                                <option value="{{ BONUS_TYPE[select] }}" ng-selected="BONUS_TYPE[select] == hit.type" ng-repeat="select in ['ABILITY', 'STAT', 'POWER_ATTACK_HIT', 'TWO_WEAPON', 'DYNAMIC' ]">{{ bonusTypeText(BONUS_TYPE[select]) }}</option>
                                                            </select>
                                                            <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                                            <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                                        </div>
                                                        <div class="col-md-6 text-capitalize" ng-click="setEdit('atkHitBonus-' + atkInd + '-' + hitInd, 'selectedCharacter.selectedLevel.selectedAttackGroup.selectedAttack.hitChance.' + hitInd + '.value')" ng-if="edit !== 'atkHitBonus-' + atkInd + '-' + hitInd && (hit.type == BONUS_TYPE.ABILITY || hit.type == BONUS_TYPE.STAT || hit.type === BONUS_TYPE.DYNAMIC)">
                                                            [ {{ hit.value }} ]
                                                        </div>
                                                        <div class="col-md-6 text-capitalize" ng-if="hit.type == BONUS_TYPE.TWO_WEAPON">
                                                            {{ getValue(selectedCharacter, selectedCharacter.selectedLevel, { 'type': BONUS_TYPE.TWO_WEAPON }) }}
                                                        </div>
                                                        <div class="col-md-6 text-capitalize" ng-if="hit.type == BONUS_TYPE.POWER_ATTACK_HIT">
                                                            {{ getValue(selectedCharacter, selectedCharacter.selectedLevel, { 'type': BONUS_TYPE.POWER_ATTACK_HIT }) }}
                                                        </div>
                                                        <div class="col-md-6" ng-if="hit.type == BONUS_TYPE.ABILITY && edit === 'atkHitBonus-' + atkInd + '-' + hitInd">
                                                            <select class="form-control input-sm" ng-model="hit.value">
                                                                <option class="text-capitalize" value="{{ select }}" ng-selected="select == hit.value" ng-repeat="select in abilityScores">{{ select }}</option>
                                                            </select>
                                                            <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                                            <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                                        </div>
                                                        <div class="col-md-6" ng-if="hit.type == BONUS_TYPE.STAT && edit === 'atkHitBonus-' + atkInd + '-' + hitInd">
                                                            <select class="form-control input-sm" ng-model="hit.value">
                                                                <option class="text-capitalize" value="{{ select }}" ng-selected="select == hit.value" ng-repeat="select in [ 'bab' ]">{{ select }}</option>
                                                            </select>
                                                            <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                                            <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                                        </div>
                                                        <div class="col-md-6" ng-if="hit.type == BONUS_TYPE.DYNAMIC && edit === 'atkHitBonus-' + atkInd + '-' + hitInd">
                                                            <input type="text" ng-model="hit.value" />
                                                            <button type="button" ng-click="clearEdit()" class="btn btn-success btn-xs glyphicon glyphicon-ok"></span>
                                                            <button type="button" ng-click="cancelEdit()" class="btn btn-danger btn-xs glyphicon glyphicon-remove"></span>
                                                        </div>

                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-md-3 row">
                                                <div class="col-md-6">
                                                    <u>Average Dmg:</u>
                                                </div>
                                                <div class="col-md-6">
                                                    <!-- TODO: Calculate -->
                                                </div>
                                            </div>
                                            <div class="col-md-3 row">
                                                <div class="col-md-6">
                                                    <u>Crit Threat</u>
                                                </div>
                                                <div class="col-md-6">
                                                    <u>Crit Multi</u>
                                                </div>
                                                <div class="col-md-6">
                                                    <!-- TODO: Input -->
                                                </div>
                                                <div class="col-md-6">
                                                    <!-- TODO: Input -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>

                </div>

            </div>

        </div>
    </div>

</div>
